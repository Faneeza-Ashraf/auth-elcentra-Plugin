// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * The simple courses block class.
 *
 * Used to produce a master-detail view of a user's enrolled courses and their activities.
 *
 * @package   block_simple_courses
 * @copyright  2025 Faneeza Muskan <faneeza.muskan@paktaleem.net>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(['jquery', 'core/log'], function($, log) {

    /**
     * The main object for the block's JavaScript.
     *
     * @type {Object}
     */
    return {
        /**
         * Initializes the interactive behavior for the simple_courses block.
         *
         * This function sets up the click handler that allows users to switch
         * between different courses and view their corresponding activities.
         *
         * @param {string} selector The CSS selector for the root element of the block instance.
         */
        init: function(selector) {
            log.debug('--- SIMPLE COURSES BLOCK JAVASCRIPT INITIALIZED ---');

            // We wait a brief moment for the DOM to be fully rendered before attaching events.
            // This solves a potential race condition where the script executes before the block's HTML is on the page.
            setTimeout(function() {
                const root = $(selector);

                if (!root.length) {
                    log.error('ERROR: simple_courses block element could not be found in the DOM.', selector);
                    return;
                }

                root.on('click', '.course-selector-item', function(e) {
                    e.preventDefault();

                    const clickedSelector = $(this);
                    if (clickedSelector.hasClass('active')) {
                        // Don't do anything if the active course is clicked again.
                        return;
                    }

                    const targetId = clickedSelector.data('course-id');
                    const courseSelectors = root.find('.course-selector-item');
                    const courseContents = root.find('.course-activity-wrapper');

                    // Update the visual state of the course selectors (left column).
                    courseSelectors.removeClass('active');
                    clickedSelector.addClass('active');

                    // Update the visibility of the activity wrappers (right column).
                    courseContents.removeClass('active');
                    root.find('.course-activity-wrapper[data-course-id="' + targetId + '"]').addClass('active');
                });

            }, 100);
        }
    };
});